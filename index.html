<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<title>HOROSCOPE</title>

<link rel="stylesheet" type="text/css" href="css/style.css">

<!-- js libraries -->
<script type="text/javascript" src="js/libs/jquery.min.js"></script>
<script type="text/javascript" src="js/libs/device.min.js"></script>
<script type="text/javascript" src="js/libs/three.min.js"></script>
<script type="text/javascript" src="js/libs/tween.min.js"></script>
<script type="text/javascript" src="js/libs/stats.min.js"></script>
<script type="text/javascript" src="js/data/data1.js"></script>
<script type="text/javascript" src="js/data/data2.js"></script>
<script type="text/javascript" src="js/data/StarPosition.js"></script>

<script type="text/javascript" src="js/main.js"></script>

</head>

<body>
<!-- elements ------------------------------------------------------------------- -->

<!-- main frame -->
<div id="main_frame"></div>
<div id="debug_text"></div>

<!-- shaders ------------------------------------------------------------------- -->
<!-- particleShader -->
<script type="x-shader/x-vertex" id="starParticleVertexShader">

uniform   float amplitude;
uniform   float direction;
attribute float size;

attribute vec3  customColor;
attribute vec3  custompositiona;
attribute vec3  custompositionb;
uniform   float time;

varying vec3  vColor;
varying float fAlpha;

void main() {

	//vColor = customColor;

	//vec3 pos = position; 

	// small noise  movement
	//pos.x += cos(time + (position.y/8.0))*150.0; 
	//pos.z += sin(time + (position.x/8.0))*150.0; 
	//pos.y += sin(time + (position.z/4.0))*140.0; 

	// morph
	vec3 morphed = vec3( 0.0, 0.0, 0.0 );
	if (direction == 0.0) {
		morphed += ( custompositionb - position ) * amplitude;
	} else {
		morphed += ( custompositiona - position ) * amplitude;
	}
	morphed += position;

	vec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );

	//fAlpha = (mvPosition.z+6000.0)/6000.0;
	//fAlpha = 1.0;

	//gl_PointSize = min(150.0, size * ( 150.0 / length( mvPosition.xyz ) ) );
	gl_PointSize = min(150.0, 5.0 * ( 150.0 / length( mvPosition.xyz ) ) );
	//gl_PointSize = 10.0;

	gl_Position = projectionMatrix * mvPosition;

}
</script> <!-- starParticleVertexShader -->

<script type="x-shader/x-fragment" id="starParticleFragmentShader">
uniform vec3 color;
uniform sampler2D texture;

varying vec3 vColor;
varying float fAlpha;

void main() {

	vec4 outColor = texture2D( texture, gl_PointCoord );
	if ( outColor.a < 0.5 ) discard; // alpha be gone
	//outColor = vec4(1,gl_PointCoord.x,0,1);
	gl_FragColor = outColor * vec4( color * vColor.xyz, fAlpha );
	gl_FragColor = outColor;
}
</script> <!-- starParticleFragmentShader -->


<!-- three.js ------------------------------------------------------------------- -->
<script type="text/javascript">

$(function(){
	
	// ----------------------------------------------
	// variablss
	// ----------------------------------------------
	// --- global variables ---
	StarPosition=[2.126,0.863,-0.351,1.925,0.842,-0.300,1.562,0.738,-0.144,2.349,1.209,0.226,1.734,1.537,1.426,1.704,1.048,1.221,1.471,0.782,1.050,1.848,0.893,1.323,1.634,0.739,1.193,1.857,0.650,1.309,1.873,0.435,1.156,1.823,0.889,1.398,1.269,0.676,1.019,1.206,1.034,1.232,1.249,1.468,2.136,1.094,1.127,1.601,1.233,1.202,1.761,1.233,1.045,1.733,1.233,0.852,1.890,1.233,0.648,1.872,1.106,0.510,1.575,1.233,0.699,2.105,0.741,0.497,1.578,0.685,0.533,1.801,0.982,0.880,2.027,0.997,1.089,2.125,0.640,0.838,1.397,0.987,1.226,1.820,-0.093,0.874,2.101,-0.094,0.748,2.674,-0.121,0.589,2.790,0.043,0.242,2.062,0.110,0.089,1.775,-0.280,0.299,2.784,-0.569,0.437,1.691,-0.737,0.601,2.010,-1.080,0.547,2.374,-0.842,0.282,1.879,-0.975,0.225,2.460,-0.527,0.002,1.390,-1.134,0.026,1.678,-1.146,-0.046,1.319,-1.296,0.258,1.879,-1.363,0.284,2.174,-1.916,0.328,1.068,-2.220,0.186,1.314,-1.688,0.020,1.025,-2.460,-0.226,1.719,-1.234,-0.200,1.014,-2.010,-0.655,1.630,-1.878,-0.630,1.277,-2.448,-0.934,1.665,-2.440,-1.030,1.630,-1.843,-0.320,1.060,-2.292,-0.601,1.181,-2.162,-0.901,1.090,-2.268,-0.074,1.118,-1.843,-0.091,0.657,-1.916,-0.068,-0.029,-2.410,-0.369,0.419,-1.916,-0.693,0.415,-2.283,-0.917,0.492,-1.587,-0.652,0.396,-2.967,-0.466,-0.005,-1.916,-0.313,-0.360,-2.233,-0.700,-0.188,-2.497,-0.957,-0.192,-1.711,-0.781,-0.105,-1.611,-0.414,-0.790,-2.218,-0.669,-1.025,-2.476,-0.880,-1.114,-1.916,-0.396,-1.010,-2.556,-0.528,-1.433,-1.430,-0.456,-0.803,-1.670,-0.595,-0.996,-1.916,-0.776,-1.195,-2.199,-1.189,-1.424,-1.916,-1.155,-1.218,-1.916,-1.280,-1.186,-1.391,-0.979,-0.850,-1.916,-1.467,-1.315,-1.916,-1.598,-1.539,-1.378,-1.127,-1.232,-1.916,-1.472,-1.710,-1.245,-0.895,-1.079,-1.916,-1.343,-1.571,-1.327,-0.364,-2.798,-1.246,-0.358,-2.523,-1.038,-0.308,-1.990,-1.303,-0.405,-2.374,-1.038,-0.467,-1.825,-1.038,-0.511,-1.710,-1.129,-0.414,-1.729,-0.847,-0.326,-1.394,-1.284,-0.356,-1.768,-1.600,-0.226,-2.044,-1.038,-0.359,-1.324,-1.117,-0.359,-1.324,-1.667,-0.420,-1.832,-1.205,-0.542,-1.533,-1.550,-0.740,-1.859,-0.984,-0.523,-2.153,-1.019,-0.713,-2.499,-0.852,-0.669,-2.175,-1.044,-0.955,-2.388,-0.726,-0.689,-1.603,-0.975,-1.029,-1.977,-1.190,-0.966,-1.986,-1.137,-1.019,-1.802,-0.370,-0.442,-2.472,-0.259,-0.378,-1.704,-0.228,-1.034,-2.388,-0.155,-0.890,-1.874,0.003,-1.136,-2.485,0.184,-0.902,-2.085,0.269,-1.009,-2.370,0.491,-1.150,-2.900,0.380,-0.562,-1.591,0.486,-0.832,-2.404,0.307,-0.868,-2.692,0.122,-0.958,-3.073,0.884,0.065,-1.563,1.077,-0.055,-2.409,0.867,-0.213,-2.809,1.401,-0.163,-2.314,1.550,-0.321,-2.659,1.318,-0.364,-2.331,1.090,0.041,-1.739,1.521,0.108,-2.321,1.393,0.073,-2.032,1.518,-0.092,-1.800,1.638,-0.162,-2.187,1.472,-0.337,-1.995,1.564,-0.443,-2.061,1.127,-0.430,-1.341,1.794,-0.383,-1.015,2.191,-0.353,-1.245,2.602,-0.340,-1.500,1.684,-0.043,-1.015,1.601,0.265,-1.131,1.407,0.324,-1.060,1.749,0.350,-1.382,2.191,0.475,-1.810,1.820,0.492,-1.554,1.635,0.495,-1.372,1.544,0.474,-1.219,2.080,0.575,-1.581,2.036,-0.300,-1.056,1.935,-0.119,-0.914,2.163,0.086,-0.843,2.584,0.093,-0.915,2.061,0.156,-0.690];
	LinePosition=[2.126,0.863,-0.351,1.925,0.842,-0.300,1.925,0.842,-0.300,1.562,0.738,-0.144,1.562,0.738,-0.144,2.349,1.209,0.226,1.734,1.537,1.426,1.704,1.048,1.221,1.704,1.048,1.221,1.471,0.782,1.050,1.471,0.782,1.050,1.848,0.893,1.323,1.848,0.893,1.323,1.634,0.739,1.193,1.634,0.739,1.193,1.857,0.650,1.309,1.857,0.650,1.309,1.873,0.435,1.156,1.634,0.739,1.193,1.823,0.889,1.398,1.823,0.889,1.398,1.269,0.676,1.019,1.269,0.676,1.019,1.206,1.034,1.232,1.249,1.468,2.136,1.094,1.127,1.601,1.094,1.127,1.601,1.233,1.202,1.761,1.233,1.202,1.761,1.233,1.045,1.733,1.233,1.045,1.733,1.233,0.852,1.890,1.233,0.852,1.890,1.233,0.648,1.872,1.233,0.648,1.872,1.106,0.510,1.575,1.233,0.648,1.872,1.233,0.699,2.105,1.233,0.699,2.105,0.741,0.497,1.578,0.741,0.497,1.578,0.685,0.533,1.801,0.741,0.497,1.578,0.982,0.880,2.027,0.982,0.880,2.027,0.997,1.089,2.125,0.997,1.089,2.125,0.640,0.838,1.397,0.640,0.838,1.397,0.987,1.226,1.820,0.987,1.226,1.820,1.249,1.468,2.136,-0.093,0.874,2.101,-0.094,0.748,2.674,-0.094,0.748,2.674,-0.121,0.589,2.790,-0.121,0.589,2.790,0.043,0.242,2.062,0.043,0.242,2.062,0.110,0.089,1.775,-0.121,0.589,2.790,-0.280,0.299,2.784,-0.569,0.437,1.691,-0.737,0.601,2.010,-0.737,0.601,2.010,-1.080,0.547,2.374,-1.080,0.547,2.374,-0.842,0.282,1.879,-0.842,0.282,1.879,-0.975,0.225,2.460,-0.975,0.225,2.460,-0.527,0.002,1.390,-0.527,0.002,1.390,-1.134,0.026,1.678,-1.134,0.026,1.678,-1.146,-0.046,1.319,-1.146,-0.046,1.319,-1.296,0.258,1.879,-1.296,0.258,1.879,-1.363,0.284,2.174,-1.363,0.284,2.174,-0.842,0.282,1.879,-1.916,0.328,1.068,-2.220,0.186,1.314,-2.220,0.186,1.314,-1.688,0.020,1.025,-1.688,0.020,1.025,-2.460,-0.226,1.719,-2.460,-0.226,1.719,-1.234,-0.200,1.014,-1.234,-0.200,1.014,-2.010,-0.655,1.630,-2.010,-0.655,1.630,-1.878,-0.630,1.277,-1.878,-0.630,1.277,-2.448,-0.934,1.665,-2.448,-0.934,1.665,-2.440,-1.030,1.630,-1.234,-0.200,1.014,-1.843,-0.320,1.060,-1.843,-0.320,1.060,-2.292,-0.601,1.181,-2.292,-0.601,1.181,-2.162,-0.901,1.090,-1.843,-0.320,1.060,-2.268,-0.074,1.118,-2.268,-0.074,1.118,-1.843,-0.091,0.657,-2.268,-0.074,1.118,-1.688,0.020,1.025,-1.916,-0.068,-0.029,-2.410,-0.369,0.419,-2.410,-0.369,0.419,-1.916,-0.693,0.415,-1.916,-0.693,0.415,-2.283,-0.917,0.492,-2.283,-0.917,0.492,-1.587,-0.652,0.396,-2.410,-0.369,0.419,-2.967,-0.466,-0.005,-2.967,-0.466,-0.005,-1.916,-0.313,-0.360,-1.916,-0.313,-0.360,-2.233,-0.700,-0.188,-2.233,-0.700,-0.188,-2.497,-0.957,-0.192,-2.497,-0.957,-0.192,-1.711,-0.781,-0.105,-1.916,-0.313,-0.360,-1.916,-0.068,-0.029,-1.611,-0.414,-0.790,-2.218,-0.669,-1.025,-2.218,-0.669,-1.025,-2.476,-0.880,-1.114,-1.611,-0.414,-0.790,-1.916,-0.396,-1.010,-1.916,-0.396,-1.010,-2.556,-0.528,-1.433,-1.611,-0.414,-0.790,-1.430,-0.456,-0.803,-1.430,-0.456,-0.803,-1.670,-0.595,-0.996,-1.670,-0.595,-0.996,-1.916,-0.776,-1.195,-1.916,-0.776,-1.195,-2.199,-1.189,-1.424,-2.199,-1.189,-1.424,-1.916,-1.155,-1.218,-1.916,-1.155,-1.218,-1.916,-1.280,-1.186,-1.916,-1.280,-1.186,-1.391,-0.979,-0.850,-1.391,-0.979,-0.850,-1.916,-1.467,-1.315,-1.916,-1.467,-1.315,-1.916,-1.598,-1.539,-1.916,-1.598,-1.539,-1.378,-1.127,-1.232,-1.378,-1.127,-1.232,-1.916,-1.472,-1.710,-1.916,-1.472,-1.710,-1.245,-0.895,-1.079,-1.245,-0.895,-1.079,-1.916,-1.343,-1.571,-1.327,-0.364,-2.798,-1.246,-0.358,-2.523,-1.246,-0.358,-2.523,-1.038,-0.308,-1.990,-1.038,-0.308,-1.990,-1.303,-0.405,-2.374,-1.303,-0.405,-2.374,-1.038,-0.467,-1.825,-1.038,-0.467,-1.825,-1.038,-0.511,-1.710,-1.038,-0.511,-1.710,-1.129,-0.414,-1.729,-1.129,-0.414,-1.729,-0.847,-0.326,-1.394,-0.847,-0.326,-1.394,-1.038,-0.467,-1.825,-1.129,-0.414,-1.729,-1.284,-0.356,-1.768,-1.284,-0.356,-1.768,-1.600,-0.226,-2.044,-1.284,-0.356,-1.768,-1.038,-0.359,-1.324,-1.038,-0.359,-1.324,-1.117,-0.359,-1.324,-1.117,-0.359,-1.324,-1.667,-0.420,-1.832,-1.038,-0.359,-1.324,-1.205,-0.542,-1.533,-1.205,-0.542,-1.533,-1.550,-0.740,-1.859,-1.038,-0.467,-1.825,-0.984,-0.523,-2.153,-0.984,-0.523,-2.153,-1.019,-0.713,-2.499,-1.019,-0.713,-2.499,-0.852,-0.669,-2.175,-0.852,-0.669,-2.175,-1.044,-0.955,-2.388,-1.044,-0.955,-2.388,-0.726,-0.689,-1.603,-0.726,-0.689,-1.603,-0.975,-1.029,-1.977,-0.975,-1.029,-1.977,-1.190,-0.966,-1.986,-0.975,-1.029,-1.977,-1.137,-1.019,-1.802,-0.370,-0.442,-2.472,-0.259,-0.378,-1.704,-0.259,-0.378,-1.704,-0.228,-1.034,-2.388,-0.228,-1.034,-2.388,-0.155,-0.890,-1.874,-0.155,-0.890,-1.874,0.003,-1.136,-2.485,0.003,-1.136,-2.485,0.184,-0.902,-2.085,0.184,-0.902,-2.085,0.269,-1.009,-2.370,0.269,-1.009,-2.370,0.491,-1.150,-2.900,0.491,-1.150,-2.900,0.380,-0.562,-1.591,0.380,-0.562,-1.591,0.486,-0.832,-2.404,0.486,-0.832,-2.404,0.307,-0.868,-2.692,0.307,-0.868,-2.692,0.122,-0.958,-3.073,0.122,-0.958,-3.073,-0.259,-0.378,-1.704,0.884,0.065,-1.563,1.077,-0.055,-2.409,1.077,-0.055,-2.409,0.867,-0.213,-2.809,0.884,0.065,-1.563,1.401,-0.163,-2.314,1.401,-0.163,-2.314,1.550,-0.321,-2.659,1.550,-0.321,-2.659,1.318,-0.364,-2.331,0.884,0.065,-1.563,1.090,0.041,-1.739,1.090,0.041,-1.739,1.521,0.108,-2.321,1.521,0.108,-2.321,1.393,0.073,-2.032,1.393,0.073,-2.032,1.518,-0.092,-1.800,1.518,-0.092,-1.800,1.638,-0.162,-2.187,1.638,-0.162,-2.187,1.472,-0.337,-1.995,1.472,-0.337,-1.995,1.564,-0.443,-2.061,1.564,-0.443,-2.061,1.127,-0.430,-1.341,1.794,-0.383,-1.015,2.191,-0.353,-1.245,2.191,-0.353,-1.245,2.602,-0.340,-1.500,2.602,-0.340,-1.500,1.684,-0.043,-1.015,1.684,-0.043,-1.015,1.601,0.265,-1.131,1.601,0.265,-1.131,1.407,0.324,-1.060,1.407,0.324,-1.060,1.749,0.350,-1.382,1.749,0.350,-1.382,2.191,0.475,-1.810,2.191,0.475,-1.810,1.820,0.492,-1.554,1.820,0.492,-1.554,1.635,0.495,-1.372,1.635,0.495,-1.372,1.544,0.474,-1.219,1.544,0.474,-1.219,2.080,0.575,-1.581,2.080,0.575,-1.581,1.407,0.324,-1.060,1.794,-0.383,-1.015,2.036,-0.300,-1.056,2.036,-0.300,-1.056,1.935,-0.119,-0.914,1.935,-0.119,-0.914,2.163,0.086,-0.843,2.163,0.086,-0.843,2.584,0.093,-0.915,2.584,0.093,-0.915,2.061,0.156,-0.690];
	var Time = {
		frameCount     : 0,
		elapsedTime    : 0,
		deltaTime      : 0,
		currentUpdate  : Date.now(),
		previousUpdate : Date.now()
	}
	
	var Mouse = {
		screenX: -1,
		screenY: -1,
		pageX: -1,
		pageY: -1,
		clientPosX: -1,
		clientPosY: -1,
		offsetX: -1,
		offsetY: -1	
	}
	
	var DeviceMotion = {
		accelerationX: -1.0,
		accelerationY: -1.0,
		accelerationZ: -1.0,
		accelerationIncludeGravityX: -1.0,
		accelerationIncludeGravityY: -1.0,
		accelerationIncludeGravityZ: -1.0,
		rotationRateAlpha: -1.0,
		rotationRateBeta:  -1.0,
		rotationRateGamma: -1.0,
	}
	
	var _worldRotationX = 0.0;
	var _worldRotationY = 0.0;
	
	var _mouseX = 0.0;
	var _mouseY = 0.0;
	var _toMouseX = 0.0;
	var _toMouseY = 0.0;
	
	var _userAgent         = null;
	var _deviceType        = null;
	var _deviceOS          = null;
	var _deviceOrientation = null;
	
	// --- webgl objects ---
	var _camera, _scene, renderer;
	
	var _stats;
	
	// objects
	var _world;
	var _bgSphere;
	var _starParticle;
	var _zodiacStarParticle;
	
	var _zoadicGraphicsPlanes = [];
	var _lineMesh;
	
	// ----------------------------------------------
	// functions
	// ----------------------------------------------
	init_deviceInfo ();
	init ();
	init_camera ();
	init_object ();
	init_light ();
	render ();
	
	function init () {
		_renderer = new THREE.WebGLRenderer(
		{
			precision:             'highp',
			alpha:                 true,
			premultipliedAlpha:    true,
			antialias:             false,
			stencil:               true,
			preserveDrawingBuffer: false,
			maxLights:             4
		});
		
		// canvas要素のサイズを指定
		_renderer.setSize(window.innerWidth, window.innerHeight);
		// 背景色を指定
		_renderer.setClearColor(0x000000, 0.0);
		
		$(_renderer.domElement).attr('id', 'main_webgl_canvas');
		
		// レンダラーをbodyに追加
		$('#main_frame').append($(_renderer.domElement));
		
		// シーンの作成
		_scene    = new THREE.Scene();
		
		// Stats
		_stats = new Stats ();
		_stats.domElement.style.position = 'fixed';
		_stats.domElement.style.right    = '5px';
		_stats.domElement.style.top      = '5px';
		document.body.appendChild(_stats.domElement);	
		
		// ウィンドウサイズが変更された時のイベントを取得
		window.addEventListener ('resize', onWindowResize, false);
	}
	
	function init_camera () {
		// カメラを作成
		_camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );
		// カメラの位置を指定
		_camera.position.set(0.0, 0.0, -2.5);
		// カメラの向きを指定
		_camera.lookAt ({x:0, y:0, z:0});
		_scene.add (_camera);
	}
	
	function init_object () {
		
		_world = new THREE.Object3D();
		_scene.add(_world);
		
		
		// 星パーティクル
		var starParticleRadiusMax = 80.0;
		var starParticleRadiusMin = 20.0;
		var starParticleGeo = new THREE.Geometry ();
		
		/*
		for ( var i = 0; i < 3000; ++i ) {
			//var vector = getRandomPointOnParticles(starParticleRadiusMin + Math.random() * starParticleRadiusMax - starParticleRadiusMin);
			var vector = randomSpherePoint (starParticleRadiusMin + Math.random() * (starParticleRadiusMax - starParticleRadiusMin));
			starParticleGeo.vertices.push( vector );
		}
		*/
		
		for ( var i = 0; i < Math.floor(data1.length/3); ++i ) {
			var vector = randomSpherePoint (starParticleRadiusMin + Math.random() * (starParticleRadiusMax - starParticleRadiusMin));
			starParticleGeo.vertices.push( vector );
		}
		
		var starParticleTex = THREE.ImageUtils.loadTexture ("./resources/images/particle.png");
		
		// particles
		attributes = {
			size:            { type: 'f',  value: [] },
			custompositiona: { type: 'v3', value: [] },
			custompositionb: { type: 'v3', value: [] },
			customColor:     { type: 'c',  value: [] },
		};
	
		uniforms = {
			amplitude: { type: "f", value: 0.0 },
			color:     { type: "c", value: new THREE.Color( 0xffffff ) },
			texture:   { type: "t", value: starParticleTex },
			time:	   { type: "f", value: 1.0 },
			direction: { type: "f", value: 1.0 },
		};
		
		var starParticleShaderMat = new THREE.ShaderMaterial( {
			uniforms: 		uniforms,
			attributes:     attributes,
			vertexShader:   document.getElementById ('starParticleVertexShader').textContent,
			fragmentShader: document.getElementById ('starParticleFragmentShader').textContent,
	
			blending: 		THREE.AdditiveBlending,
			depthTest: 		false,
			transparent:	true,	
		});
		
		var starParticleMat = new THREE.PointCloudMaterial ({
			size: 2,
			color: 0xFFFFFF,
			blending: THREE.AdditiveBlending,
  			transparent: true,
			depthTest: false,
			map: starParticleTex		
		});
		
		_starParticle = new THREE.PointCloud (starParticleGeo, starParticleShaderMat);
		
		var vertices     = _starParticle.geometry.vertices;
		var values_size  = attributes.size.value;
		var values_color = attributes.customColor.value;
		
		baseSize = [];
		
		for (var v = 0; v < vertices.length; v++) {
			baseSize [v] = 40 + Math.random () * 360;
			
			values_size [v]  = baseSize [v];
			values_color [v] = new THREE.Color (0xFFFFFF);
			
			values_color[ v ].setHSL( 0.55, 0.75 * ( v / vertices.length ), 1.0 );
		}
		
		var values_positiona = attributes.custompositiona.value;
		var values_positionb = attributes.custompositionb.value;
		
		for (var v = 0; v < vertices.length; v++) {
			var index = v * 3;
			
			if (index > data1.length) {
				values_positiona [v] = randomSpherePoint (starParticleRadiusMin + Math.random() * (starParticleRadiusMax - starParticleRadiusMin));
				values_positionb [v] = randomSpherePoint (starParticleRadiusMin + Math.random() * (starParticleRadiusMax - starParticleRadiusMin));
			} else {
				var vector = new THREE.Vector3(data1[index], data1[index+2], data1[index+1]);
				vector.multiplyScalar(2.0);
				values_positiona[ v ] = vector;
	
				var vector = new THREE.Vector3(data2[index], data2[index+2], data2[index+1]);
				//vector.multiplyScalar(170);
				values_positionb[ v ] = vector;
			}
		}
		console.log (vertices.length);
		
		_world.add (_starParticle);
		// also update the particle system to
		// sort the particles which enables
		// the behaviour we want
		_starParticle.sortParticles = true;
		
		
		// --------------------------------------------------------------------
		// 主要な星座の星のパーティクル
		var zodiacStarParticleGeo = new THREE.Geometry ();
		for ( var i = 0; i < Math.floor(StarPosition.length/3); ++i ) {
			var index = i * 3;
			var scale = 5.0;
			zodiacStarParticleGeo.vertices.push( new THREE.Vector3 (-StarPosition[index] * scale, StarPosition[index+1] * scale, StarPosition[index+2] * scale));
		}
		
		var zodiacStarParticleMat = new THREE.PointCloudMaterial ({
			size:        1,
			color:       0xBBBBFF,
			blending:    THREE.AdditiveBlending,
  			transparent: true,
			depthTest:   false,
			map:         starParticleTex		
		});
		
		_zodiacStarParticle = new THREE.PointCloud (zodiacStarParticleGeo, zodiacStarParticleMat);
		_world.add (_zodiacStarParticle);
		
		
		// 主要な星座のグラフィックス用プレーン
		
		var zodiacGraphicsImagePathArray = [];
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Aries.png");  // 04
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Taurus.png"); // 05
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Gemini.png"); // 06
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Cancer.png"); // 07
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Leo.png"); // 08
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Virgo.png"); // 09
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Libra.png"); // 10
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Scorpio.png"); // 11
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Sagittarius.png"); // 12
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Capricorn.png"); // 01		
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Aquarius.png"); // 02
		zodiacGraphicsImagePathArray.push ("./resources/images/Zodiac_Pisces.png"); // 03
		
		var zodiacGraphicsPlaneGeo = new THREE.PlaneGeometry (1, 1);
		
		for (var i = 0; i < zodiacGraphicsImagePathArray.length; i++) {
			//console.log (zodiacGraphicsImagePathArray [i]);
			var zodiacGraphicsPlaneMat = new THREE.MeshBasicMaterial ({
				color: 0xFFFFFF,
				blending: THREE.AdditiveBlending,
  				//transparent: true,
				map: THREE.ImageUtils.loadTexture(zodiacGraphicsImagePathArray [i])
			});
			var plane = new THREE.Mesh (zodiacGraphicsPlaneGeo, zodiacGraphicsPlaneMat);
			
			var ang = -(Math.PI*2.0/12.0)*i + Math.PI;
			var pos = new THREE.Vector3 (
				6.0 * Math.cos (ang),
				Math.sin (i * 0.5 + 0.91) * 2.0,
				6.0 * Math.sin (ang)
			);
			plane.position = pos;
			plane.rotation.set (Math.PI*0.5, 0.0, Math.PI*0.5 + ang);
			plane.scale.set (4,4,4);
			
			_world.add (plane);
			_zoadicGraphicsPlanes.push (plane);	
		}
		
		/*
		// 背景の球体
		var bgSphereGeo = new THREE.SphereGeometry (101, 12, 12);
		// テクスチャ
		var bgSphereTex = THREE.ImageUtils.loadTexture ('./resources/images/UVTextureChecker2048.png');
		
		var bgSphereMat = new THREE.MeshBasicMaterial (
			{
				color     : 0xFFFFFF,
				wireframe : true,
				map       : bgSphereTex,
				side      : THREE.DoubleSide
			});
		_bgSphere = new THREE.Mesh (bgSphereGeo, bgSphereMat);
		_world.add(_bgSphere);
		*/
		
		// 水平線上の円状のライン
		var outerHorizontalCircleLineMat = new THREE.LineBasicMaterial ({
			color: 0xFFFFFF
		});
		
		var outerHorizontalCircleLineGeo = new THREE.Geometry ();
		for (var i = 0; i < 48; i++) {
			var ang = (Math.PI * 2.0) / 48.0 * i;
			outerHorizontalCircleLineGeo.vertices.push (
				new THREE.Vector3 (
					40.0 * Math.cos (ang),
					0.0,
					40.0 * Math.sin (ang)
				)
			);
		}
		
	
		var outerHorizontalCircleLine = new THREE.Line (outerHorizontalCircleLineGeo, outerHorizontalCircleLineMat);
		_world.add (outerHorizontalCircleLine);
		
		// 座標軸
		var axisHelper = new THREE.AxisHelper (1);
		axisHelper.position.set (0,0,0);
		//axisHelper.scale.set(0.01, 0.01, 0.01);
		_world.add (axisHelper);

		// Lines
		var lineGeometry = new THREE.BufferGeometry();
		var linePositions = new Float32Array(LinePosition.length);
		for ( var i = 0, len = linePositions.length; i < len; i++ ) {
			linePositions[i] = LinePosition[i] * 300;
		}
		var lineColors = new Float32Array( linePositions.length);
		for (var i = 0, len = lineColors.length / 3; i < len; i++) {
			lineColors[i*3+0] = 1.0;
			lineColors[i*3+1] = i / len;
			lineColors[i*3+2] = 0.0;
		}
		lineGeometry.drawcalls.push( {
					start: 0,
					count: linePositions.length / 3,
					index: 0
				} );
		lineGeometry.addAttribute( 
			'position', 
			new THREE.BufferAttribute( linePositions, 3 ) 
			);
		lineGeometry.addAttribute( 
			'color', 
			new THREE.DynamicBufferAttribute( lineColors, 3 ) 
			);
		var lineMaterial = new THREE.LineBasicMaterial( {
			vertexColors: THREE.VertexColors,
			blending: THREE.AdditiveBlending,
			transparent: true,
			linewidth : 3
			} );
		_lineMesh = new THREE.Line( 
			lineGeometry, 
			lineMaterial, 
			// THREE.LinePieces 
			THREE.LineStrip
		);
		_world.add(_lineMesh);

	}
	
	function init_light () {
		
	}
	
	function render () {
		requestAnimationFrame(render);
		
		_stats.begin ();
		
		Time.currentUpdate  = Date.now ();
		Time.deltaTime      = (Time.currentUpdate - Time.previousUpdate) / 1000.0;
		Time.previousUpdate = Time.currentUpdate;
		
		if (device.portrait()) {
			_deviceOrientation = "portrait";	
		} else if (device.landscape()) {
			_deviceOrientation = "landscape";
		} else {
			
		}
		
		if (_deviceType == "desktop") {
			var windowHalfX = window.innerWidth >> 1;
			var windowHalfY = window.innerHeight >> 1;
	
			_mouseX = ( Mouse.clientPosX - windowHalfX );
			_mouseY = ( Mouse.clientPosY - windowHalfY );
			
			_toMouseX += (_mouseX-_toMouseX)/30;
			_toMouseY += (_mouseY-_toMouseY)/30;
	
			_worldRotationX  = _toMouseY/1000;
			_worldRotationY += _toMouseX/20000;
		} else {
			// rotationRateを使用
			// _worldRotationX += DeviceMotion.rotationRateAlpha * Time.deltaTime * 0.01;
			_worldRotationY -= DeviceMotion.rotationRateBeta * Time.deltaTime * 0.02;

			var gy = (DeviceMotion.accelerationIncludeGravityZ > 0) ? DeviceMotion.accelerationIncludeGravityY + 10.0 : map(DeviceMotion.accelerationIncludeGravityY, -10.0, 0.0, 0.0, -10.0, false);
			var distinationX = map(gy, -10.0, 10.0, -Math.PI * 0.5, Math.PI * 0.5, false);
			_worldRotationX += ( distinationX - _worldRotationX ) * 0.1;
		}
		
		_world.rotation.set (_worldRotationX, _worldRotationY, 0);
		

		TWEEN.update();
		_renderer.render (_scene, _camera); 

		// update line
		var lineNum = _lineMesh.geometry.attributes.position.array.length / 3;
		_lineMesh.geometry.drawcalls[ 0 ].count = Time.frameCount % lineNum;

		_lineMesh.geometry.attributes.position.needsUpdate = true;
		_lineMesh.geometry.attributes.color.needsUpdate = true;
		
		_renderer.render (_scene, _camera); 
		// デバッグテキスト
		drawDebugText ();

		
		Time.elapsedTime += Time.deltaTime;
		Time.frameCount++;
		
		_stats.end ();
	};
	
	function init_deviceInfo () {
		_userAgent = window.navigator.userAgent.toLowerCase();
		
		if (device.mobile()) {
			_deviceType = "mobile";	
		} else if (device.tablet()) {
			_deviceType = "tablet";
		} else {
			_deviceType = "desktop";
		}
		
		if (device.ios()) {
			_deviceOS = "ios";
		} else if (device.ipad()) {
			_deviceOS = "ipad";
		} else if (device.iphone()) {
			_deviceOS = "iphone";
		} else if (device.ipod()) {
			_deviceOS = "ipod";
		} else if (device.android()) {
			_deviceOS = "android";
		} else if (device.androidPhone()) {
			_deviceOS = "androidPhone";
		} else if (device.androidTablet()) {
			_deviceOS = "androidTablet";
		} else if (device.blackberry()) {
			_deviceOS = "blackberry";
		} else if (device.blackberryTablet()) {
			_deviceOS = "blackberryTablet";
		} else if (device.windows()) {
			_deviceOS = "windows";
		} else if (device.windowsPhone()) {
			_deviceOS = "windowsPhone";
		} else if (device.windowsTablet()) {
			_deviceOS = "windowsTablet";
		} else {
			
		}
		
		if (device.portrait()) {
			_deviceOrientation = "portrait";	
		} else if (device.landscape()) {
			_deviceOrientation = "landscape";
		} else {
			
		}
	}
	
	function moveCamera () {
		
		new TWEEN.Tween (_camera.position)
				.to ({
					x: 0,
					y: 0,
					z: -30
				}, 5000)
				.easing (TWEEN.Easing.Quadratic.InOut)
				.start();
				
				
		//_camera.position.z = Math.random ();
	}
	
	function getRandomPointOnParticles (r) {
		var angle = Math.random() * Math.PI * 2;
		var u = Math.random() * 2 - 1;
	
		var v = new THREE.Vector3(
			Math.cos(angle) * Math.sqrt(1 - Math.pow(u, 2)) * r,
			Math.sin(angle) * Math.sqrt(1 - Math.pow(u, 2)) * r,
			u * r
		);
		return v;
	}
	
	function randomSpherePoint (radius){
		var u = Math.random();
		var v = Math.random();
		var theta = 2 * Math.PI * u;
		var phi   = Math.acos(2 * v - 1);
		var x = radius * Math.sin(phi) * Math.cos(theta);
		var y = radius * Math.sin(phi) * Math.sin(theta);
		var z = radius * Math.cos(phi);
		return new THREE.Vector3 (x, y, z);
	}

	function map(value, inputMin, inputMax, outputMin, outputMax, clamp) {
		var outVal = ((value - inputMin) / (inputMax - inputMin) * (outputMax - outputMin) + outputMin);
		if( clamp ){
			if(outputMax < outputMin){
				if( outVal < outputMax )outVal = outputMax;
				else if( outVal > outputMin )outVal = outputMin;
			}else{
				if( outVal > outputMax )outVal = outputMax;
				else if( outVal < outputMin )outVal = outputMin;
			}
		}
		return outVal;

	}
	
	function onWindowResize() {
		// アスペクト比を設定
		_camera.aspect = window.innerWidth / window.innerHeight;
		// カメラの設定を更新
		_camera.updateProjectionMatrix ();
		// canvas要素のサイズを設定
		_renderer.setSize( window.innerWidth, window.innerHeight );
	}
	
	// ------- Events -------------------------------------------------
	// ------- Mouse Position --------
    function getMouseXY_ie(){ /* IE */
        Mouse.screenX    = event.screenX;
        Mouse.screenY    = event.screenY;
        Mouse.pageX      = event.pageX;
        Mouse.pageY      = event.pageY;
        Mouse.clientPosX = event.clientX;
        Mouse.clientPosY = event.clientY;
        Mouse.offsetX    = event.offsetX;
        Mouse.offsetY    = event.offsetY;
    }
    function getMouseXY(event){ /* Firefox, Netscape */
        Mouse.screenX    = event.screenX;
        Mouse.screenY    = event.screenY;
        Mouse.pageX      = event.pageX;
        Mouse.pageY      = event.pageY;
        Mouse.clientPosX = event.clientX;
        Mouse.clientPosY = event.clientY;
        Mouse.offsetX    = event.offsetX;
        Mouse.offsetY    = event.offsetY;
    }
   	document.onmousemove=(document.all) ? getMouseXY_ie : getMouseXY;
	
	// ------- Device Motion -------
	function deviceMotion (e)
	{
		e.preventDefault();
		var ac = e.acceleration;
		var ag = e.accelerationIncludingGravity;
		var rt = e.rotationRate;
		
		DeviceMotion.accelerationX               = Number(ac.x);
		DeviceMotion.accelerationY               = Number(ac.y);
		DeviceMotion.accelerationZ               = Number(ac.z);
		DeviceMotion.accelerationIncludeGravityX = Number(ag.x);
		DeviceMotion.accelerationIncludeGravityY = Number(ag.y);
		DeviceMotion.accelerationIncludeGravityZ = Number(ag.z);
		DeviceMotion.rotationRateAlpha           = Number(rt.alpha);
		DeviceMotion.rotationRateBeta            = Number(rt.beta);
		DeviceMotion.rotationRateGamma           = Number(rt.gamma);
	}
	window.addEventListener("devicemotion", deviceMotion);
	
	// ------- KeyEvent -------
	document.onkeyup = function (e) {

		if (!e) e = window.event;
	
		console.log ("keyCode : " + e.keyCode);
	
		switch (e.keyCode) {
			case 65: // a
				//tweenUp ();
				//var tween = new TWEEN.Tween(_camera.position)
				//.to({z:200}, 1000)
				//.easing(TWEEN.Easing.Back.EaseOut);
				//tween.start();
				//_camera.position.set(0,0,-100);
				
				moveCamera ();
				
				break;
			case 83: // s
				
				new TWEEN.Tween (uniforms.amplitude)
				.to ({
					value: 0
				}, 5000)
				.easing (TWEEN.Easing.Quadratic.InOut)
				.start();
				
				break;
			case 68: // d
			
			new TWEEN.Tween (uniforms.amplitude)
				.to ({
					value: 1
				}, 5000)
				.easing (TWEEN.Easing.Quadratic.InOut)
				.start();
				
				break;
			case 70: // f
				
				break;
			default:
	
				break;
		}
	}
		
	// ------- ------------------------------------------
	function drawDebugText () {
		$('#debug_text').html (
			"Time.deltaTime      : " + Time.deltaTime      + "<br/>" +
			"Time.elapsedTime    : " + Time.elapsedTime    + "<br/>" +
			"Time.frameCount     : " + Time.frameCount     + "<br/>" +
			"Time.currentUpdate  : " + Time.currentUpdate  + "<br/>" +
			"Time.previousUpdate : " + Time.previousUpdate + "<br/>" +
			"Mouse.clientPosX    : " + Mouse.clientPosX    + "<br/>" +
			"Mouse.clientPosY    : " + Mouse.clientPosY    + "<br/>" +
			"_worldRotationX     : " + _worldRotationX     + "<br/>" +
			"_worldRotationY     : " + _worldRotationY     + "<br/>" +
			"deviceType          : " + _deviceType         + "<br/>" +
			"deviceOS            : " + _deviceOS           + "<br/>" +
			"deviceOrientation   : " + _deviceOrientation  + "<br/>" +
			"DeviceMotion.accelerationIncludeGravityX            : " + DeviceMotion.accelerationIncludeGravityX           + "<br/>" +
			"DeviceMotion.accelerationIncludeGravityY          : " + DeviceMotion.accelerationIncludeGravityY           + "<br/>" +
			"DeviceMotion.accelerationIncludeGravityZ            : " + DeviceMotion.accelerationIncludeGravityZ           + "<br/>"
		);
	}

	function map(value, inputMin, inputMax, outputMin, outputMax, clamp) {
		var outVal = ((value - inputMin) / (inputMax - inputMin) * (outputMax - outputMin) + outputMin);
		if( clamp ){
			if(outputMax < outputMin){
				if( outVal < outputMax )outVal = outputMax;
				else if( outVal > outputMin )outVal = outputMin;
			}else{
				if( outVal > outputMax )outVal = outputMax;
				else if( outVal < outputMin )outVal = outputMin;
			}
		}
		return outVal;

	}
});

</script>

</body>
</html>
